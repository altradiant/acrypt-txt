## DES; режимы CBC и CTR на его примере

DES (Data Encryption Standard) — это устаревший (на данный момент его бывшее место стандарта шифрования занимает AES, с 26 мая 2002 года) блочный шифр, который шифрует данные блоками фиксированной длины (64 бита). Он поддерживает различные режимы работы, которые определяют, как блоки данных связываются между собой. Рассмотрим два его режима: **CBC (Cipher Block Chaining)** и **CTR (Counter Mode)**.

//

*Учтите, что в большинстве случаев принципы работы CBC и CTR повторяются в других шифрах. Здесь они разобраны на примере DES.*

*А также то, что первоначальный ключ в обеих программных реализациях преобразуется по хэш-функции, а также то, что выходной результат шифрования кодируется с помощью base64; соответственно, при расшифровке сначала происходит раскодировка base64.

***Это также распространяется на все другие современные шифры, реализованные в программе.***

## Режим CBC (Cipher Block Chaining)

### Принцип работы

#### Шифрование

1. **Инициализация**:  
   - Создается инициализационный вектор (IV), который представляет собой случайное значение той же длины, что и блок данных (64 бита).  
   - IV должен быть уникальным для каждого сообщения, зашифрованного с использованием одного и того же ключа.

2. **Шифрование первого блока**:  
   - Первый блок открытого текста XOR'ится с IV.  
   - Результат XOR'а затем шифруется с использованием ключа и блочного шифра DES.

3. **Шифрование последующих блоков**:  
   - Каждый последующий блок открытого текста XOR'ится с результатом шифрования предыдущего блока.  
   - Результат XOR'а затем шифруется с использованием ключа и блочного шифра DES.

IV крепится в своем неизменённом виде к началу шифротекста (для последующей расшифровки).

#### Расшифрование

1. **Расшифрование первого блока**:  
   - Первый блок зашифрованного текста расшифровывается с использованием ключа и блочного шифра DES.  
   - Результат расшифрования XOR'ится с IV, что восстанавливает первый блок открытого текста.

2. **Расшифрование последующих блоков**:  
   - Каждый последующий блок зашифрованного текста расшифровывается с использованием ключа и блочного шифра DES.  
   - Результат расшифрования XOR'ится с предыдущим блоком зашифрованного текста, что восстанавливает исходный блок открытого текста.

//

## Режим CTR (Counter Mode)

### Принцип работы

#### Шифрование

1. **Инициализация**:  
   - Создается счетчик (counter), который состоит из двух частей:  
     - **Nonce (уникальное значение)**: Это значение должно быть уникальным для каждого сообщения, зашифрованного с использованием одного и того же ключа.  
     - **Счетчик (counter)**: Это значение увеличивается на 1 для каждого следующего блока данных.  
   - Nonce и счетчик объединяются в один блок, который затем шифруется с использованием ключа (nonce служит префиксом).
   - Nonce - 4 байта; Счётчик - 4 байта (итого - 8 байт (один блок))

2. **Генерация гаммы**:  
   - Каждый блок счетчика шифруется с использованием блочного шифра DES. Результат шифрования образует гамму (keystream) (ключевой поток).

3. **Шифрование данных**:  
   - Каждый блок открытого текста XOR'ится с соответствующим блоком гаммы. Результатом этой операции является зашифрованный текст.

Nonce крепится в своем неизменённом виде к началу шифротекста (для последующей расшифровки).

Расшифрование в режиме CTR выполняется точно так же, как и шифрование. Для каждого блока зашифрованного текста выполняется операция XOR с тем же потоком гаммы, который использовался при шифровании. Результат этой операции восстанавливает исходный блок открытого текста.

На этот раздел отведено четыре задания. **Вам понадобится информация из разделов 3.1 и 3.3.**

Режим CBC и режим CTR представляют собой два разных подхода к использованию блочного шифра DES. Режим CBC обеспечивает связь между блоками данных, что делает его устойчивым к атакам на основе повторяющихся блоков, но при этом требует последовательной обработки. Режим CTR, напротив, позволяет параллельно обрабатывать блоки данных, но требует осторожности при использовании счетчика, чтобы избежать уязвимостей.